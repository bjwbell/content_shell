node {
   stage 'Checkout'
   sh "rm -rf src/"
   sh "rm -rf _bad_scm/"
   sh "rm -f .gclient .gclient_entries"
   sh "fetch --nohooks chromium"
   sh "cd src/; git remote add codecommit ssh://APKAJHXR727PTXMIECSQ@git-codecommit.us-east-1.amazonaws.com/v1/repos/chrome"
   sh "cd src/; git fetch codecommit ironframe"
   sh "cd src/; git checkout ironframe"
   sh "cd src/; gclient runhooks"
   sh "cd src/; gclient sync"
   sh "cd src/; gn gen out/Default"
   stage 'Build Current'
   sh "cd src/; ninja -C out/Default content_shell"
   stage 'Merge'
   sh "cd src/; git rebase master"
   stage 'Build Merge'
   sh "cd src/; gclient sync"
   sh "cd src/; gn gen out/Default"
   sh "cd src/; ninja -C out/Default content_shell"
   stage 'Push'
   sh "cd src/; git push --force-with-lease codecommit ironframe"
   sh "cd src/; git push codecommit master"
   stage 'Cleanup'
   sh "rm -rf src/"
   sh "rm -f .gclient .gclient_entries"
}
