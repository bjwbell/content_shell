node {
   stage 'Checkout'
   sh "rm -rf src/"
   sh "rm -rf _bad_scm/"
   sh "rm -f .gclient .gclient_entries"
   sh "fetch chromium"
   sh "cd src/; git remote add codecommit ssh://APKAJHXR727PTXMIECSQ@git-codecommit.us-east-1.amazonaws.com/v1/repos/chrome"
   sh "cd src/; git pull codecommit master"
   sh "cd src/; git fetch codecommit ironframe"
   sh "cd src/; git checkout ironframe"
   stage 'Diff'
   sh "cd src/; git format-patch master --stdout > ../../../ironframe/diffs/ironframe-`date -Iminutes`.patch"
   stage 'Push'
   sh "cd ../../ironframe; git pull origin master"
   sh "cd ../../ironframe; git add diffs/*.patch"
   sh "cd ../../ironframe; git commit -m \"Add `date -Iminutes`.patch\""
   sh "cd ../../ironframe; git push origin master"
}